<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head">
</head>
<body>
    <div th:replace="fragments/navbar :: navbar"></div>
    <div class="container">
        <h3 class="page-header">Statistics on tournament cardpools</h3>

        <div class="row top-buffer">
            <div class="col-md-8 col-xs-12">
                <div class="col-xs-12">
                    <h4>
                        Runner factions over time (top 30% ranks)
                        <ktm:tooltip place="right" text="The charts show the popularity of factions among the top 30%
                        ranking decks over time. Time is represented by tournament legal cardpool."/>
                    </h4>
                    <div id="chart_div1" class="chart-responsive spinner"></div>
                </div>
                <div class="col-xs-12">
                    <h4>
                        Corp factions over time (top 30% ranks)
                        <ktm:tooltip place="right" text="The charts show the popularity of factions among the top 30%
                        ranking decks over time. Time is represented by tournament legal cardpool."/>
                    </h4>
                    <div id="chart_div2" class="chart-responsive spinner"></div>
                </div>
            </div>
            <div class="col-md-4 col-xs-12">
                <div class="col-xs-12">
                    <h4>
                        Tournament Drilldown
                        <ktm:tooltip place="top" text="Click on an expansion name for more information on tournaments with that cardpool."/>
                    </h4>
                    <div class="list-group">
                        <a href="/DPStats/Last%203%20aggregated" class="list-group-item list-group-item-info"><em>last 3 aggregated</em></a>
                        <a th:each="cardpool : ${cardpools}" th:text="${cardpool}" th:href="@{/DPStats/__${cardpool}__/}" class="list-group-item"></a>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="panel panel-default top-buffer" id="infopanel">
                        <div class="panel-heading">Welcome</div>
                        <div class="panel-body text-justify">
                            <p>
                                Welcome to <strong>Know the Meta</strong>. This site provides statistical information
                                on the cardgame <strong>Android: Netrunner</strong>.
                            </p>
                            <p>
                                <strong>Know the Meta</strong> has data on what kind of factions, identities, decks
                                and cards are being played at tournaments.
                            </p>
                            <p>
                                Keep posting your tournament decklists to <strong>Acoo.net</strong> or <strong>Stimhack</strong>,
                                so <strong>Know the Meta</strong> can provide the information you seek.
                                <div class="row">
                                    <div class="col-md-6 text-center">
                                        <a href="http://www.acoo.net/" target="_blank" rel="nofollow">
                                            <img th:src="@{/static/img/acoo-logo.png}"/>
                                        </a>
                                    </div>
                                    <div class="col-md-6 text-center">
                                        <a href="http://stimhack.com/tournament-decklists/" target="_blank" rel="nofollow">
                                            <img th:src="@{/static/img/stimhack-logo.png}"/>
                                        </a>
                                     </div>
                                </div>
                            </p>
                        </div>
                    </div>
                    <p class="text-center">
                        <small>last update: <span th:text="${lastUpdate}"></span></small>
                    </p>
                </div>
            </div>
        </div>
        <h3 class="page-header">Latest blog entries <a href="/RSS/blog"><i class="fa fa-rss-square"></i></a></h3>
        <div class="row">
            <div class="col-md-8 col-xs-12">
                <div class="row">
                    <div class="col-xs-12" th:each="blog : ${blogs}">
                        <div class="row">
                            <div class="col-md-3 teaser-col">
                                <a th:href="@{/Blog/__${blog.url}__}"><img th:src="${blog.imageUri}" th:alt="${blog.title}"/></a>
                            </div>
                            <div class="col-md-9 teaser-col">
                                <h5>
                                    <a th:href="@{/Blog/__${blog.url}__}" th:text="${blog.title}"></a><br/>
                                    <small><span th:text="${blog.formattedDate}"></span> - <span th:text="${blog.pack}"></span></small>
                                </h5>
                                <div th:utext="${blog.teaser}" class="text-justify"></div>
                                <a th:href="@{/Blog/__${blog.url}__}">Read more</a>
                            </div>
                        </div>
                        <hr />
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-xs-12">
                <div th:replace="fragments/social :: social"></div>
                <div th:replace="fragments/googlead :: blog"></div>
            </div>
        </div>

        <div th:replace="fragments/footer :: footer"></div>
    </div>
    <div th:replace="fragments/head :: scripts"></div>

    <script type="text/javascript"
            src="https://www.google.com/jsapi?autoload={
            'modules':[{
              'name':'visualization',
              'version':'1',
              'packages':['corechart']
            }]
          }"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        google.setOnLoadCallback(drawData);

        function drawData() {
            drawChart("/DataTable/Cardpool/runner","chart_div1");
            drawChart("/DataTable/Cardpool/corp","chart_div2");
        }

        $(window).resize(function(){
            drawChart("/DataTable/Cardpool/runner","chart_div1");
            drawChart("/DataTable/Cardpool/corp","chart_div2");
        });

        function drawChart(urlvalue, elementid) {

            var linecolors = new Array;

            var jsonData = $.ajax({
                url: urlvalue,
                dataType: "json",
                async: false,
                success: function(data) {
                    $.each(data.cols, function (index, element) {
                        linecolors.push({color : element.id});
                    });
                }
            }).responseText;

            linecolors.splice(0, 1); // removing first entry

            var data = new google.visualization.DataTable(jsonData);

            var options = {
                'height': 350,
                'curveType': 'function',
                'vAxis': { format:'#,#%', viewWindowMode: 'explicit', viewWindow: { min: 0 } },
                'hAxis': { showTextEvery: 1, slantedText: 'true' },
                'chartArea': { top: 10, bottom: 10, height: '70%' },
                'legend': { position: 'right', maxLines: 6 },
                'series': linecolors,
                'lineWidth': 3
            };

            var chart = new google.visualization.LineChart(document.getElementById(elementid));
            chart.draw(data, options);
            $('#'+elementid).removeClass('spinner');
        }
        /*]]>*/
    </script>
    <div th:replace="fragments/analytics :: ga"></div>
</body>
</html>